#!/bin/bash
set -euo pipefail

if [ $# -eq 0 ]; then
  echo "Error: No video file provided."
  echo "Usage: vidstream <video-file>"
  exit 1
fi
videofile=$1
if [ ! -f "$videofile" ]; then
  echo "Error: File '$videofile' not found."
  exit 1
fi

echo "Starting GStreamer pipeline.."
echo ---------------------------------
echo $videofile

# GStreamer pipeline
gst-launch-1.0 filesrc location="$videofile" \
  ! decodebin \
  ! x264enc tune=zerolatency \
  ! rtph264pay config-interval=1 pt=96 \
  ! udpsink host=224.1.1.1 port=5000 auto-multicast=true